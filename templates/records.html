{% extends "base.html" %}
{% block content %}
<style>
  .filters {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 12px;
    margin-bottom: 12px;
  }
  .filters label {
    display: flex;
    flex-direction: column;
    font-size: .8rem;
    color: var(--muted);
    gap: 4px;
  }
  .filters input,
  .filters select {
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 10px;
    font-size: .95rem;
  }
  .filters button {
    border: none;
    border-radius: 12px;
    padding: 12px;
    font-weight: 600;
    background: var(--accent);
    color: #fff;
    cursor: pointer;
  }
  .records-table {
    overflow-x: auto;
  }
  .pill {
    display: inline-flex;
    align-items: center;
    padding: 2px 8px;
    border-radius: 999px;
    font-size: .75rem;
    background: rgba(37, 99, 235, 0.15);
    color: var(--accent-strong);
  }
</style>

<div class="card">
  <h2 style="margin-bottom:8px;">入力一覧</h2>
  <p style="margin:0 0 16px;color:var(--muted);font-size:.9rem;">直近 {{ rows|length }} 件を表示中（最大 {{ records_limit }} 件）</p>

  <form class="filters" method="get">
    {{ form.hidden_tag() }}
    <label>
      {{ form.machine_no.label }}
      {{ form.machine_no() }}
    </label>
    <label>
      {{ form.shift.label }}
      {{ form.shift() }}
    </label>
    <label>
      {{ form.date_from.label }}
      {{ form.date_from() }}
    </label>
    <label>
      {{ form.date_to.label }}
      {{ form.date_to() }}
    </label>
    <button type="submit">絞り込む</button>
  </form>

  <div class="records-table">
    <table>
      <thead>
        <tr>
          <th>日付</th>
          <th>勤</th>
          <th>号機</th>
          <th>機種</th>
          <th>環境温</th>
          <th>環境湿</th>
          <th>材料ロット</th>
          <th>射出(s)</th>
          <th>計量(s)</th>
          <th>V-P位置</th>
          <th>V-P圧</th>
          <th>クッション</th>
          <th>ピーク</th>
          <th>CT</th>
          <th>ショット</th>
          <th>金型温(固)</th>
          <th>金型温(稼)</th>
          <th>ノズル温</th>
          <th>シリ前</th>
          <th>シリ中1</th>
          <th>シリ中2</th>
          <th>シリ後</th>
          <th>射速1</th>
          <th>射速2</th>
          <th>切替位</th>
          <th>射圧</th>
          <th>射時</th>
          <th>保圧1</th>
          <th>保圧2</th>
          <th>保圧1s</th>
          <th>保圧2s</th>
          <th>保圧圧</th>
          <th>計量位</th>
          <th>背圧</th>
          <th>回転</th>
          <th>冷却</th>
          <th>変化点メモ</th>
        </tr>
      </thead>
      <tbody>
        {% for r in rows %}
          <tr>
            <td>{{ r.work_date }}</td>
            <td>{{ r.shift }}</td>
            <td><span class="pill">#{{ r.machine_no }}</span></td>
            <td>{{ r.model_name }}</td>
            <td>{{ "%.1f"|format(r.environment_temp) if r.environment_temp is not none else "-" }}</td>
            <td>{{ "%.1f"|format(r.environment_humidity) if r.environment_humidity is not none else "-" }}</td>
            <td>{{ r.material_lot or "" }}</td>
            <td>{{ "%.3f"|format(r.inj_time) if r.inj_time is not none else "-" }}</td>
            <td>{{ "%.2f"|format(r.metering_time) if r.metering_time is not none else "-" }}</td>
            <td>{{ "%.3f"|format(r.vp_position) if r.vp_position is not none else "-" }}</td>
            <td>{{ "%.1f"|format(r.vp_pressure) if r.vp_pressure is not none else "-" }}</td>
            <td>{{ "%.2f"|format(r.min_cushion) if r.min_cushion is not none else "-" }}</td>
            <td>{{ "%.1f"|format(r.peak_pressure) if r.peak_pressure is not none else "-" }}</td>
            <td>{{ "%.2f"|format(r.cycle_time) if r.cycle_time is not none else "-" }}</td>
            <td>{{ r.shot_count if r.shot_count is not none else "-" }}</td>
            <td>{{ r.mold_temp_fixed or "" }}</td>
            <td>{{ r.mold_temp_moving or "" }}</td>
            <td>{{ r.nozzle_temp or "" }}</td>
            <td>{{ r.cylinder_front_temp or "" }}</td>
            <td>{{ r.cylinder_mid1_temp or "" }}</td>
            <td>{{ r.cylinder_mid2_temp or "" }}</td>
            <td>{{ r.cylinder_rear_temp or "" }}</td>
            <td>{{ r.injection_speed_1 or "" }}</td>
            <td>{{ r.injection_speed_2 or "" }}</td>
            <td>{{ r.injection_switch_position or "" }}</td>
            <td>{{ r.injection_pressure_setting or "" }}</td>
            <td>{{ r.injection_time_setting or "" }}</td>
            <td>{{ r.hold_pressure_1 or "" }}</td>
            <td>{{ r.hold_pressure_2 or "" }}</td>
            <td>{{ r.hold_time_1 or "" }}</td>
            <td>{{ r.hold_time_2 or "" }}</td>
            <td>{{ r.hold_pressure_total or "" }}</td>
            <td>{{ r.metering_position or "" }}</td>
            <td>{{ r.back_pressure or "" }}</td>
            <td>{{ r.screw_rotation_speed or "" }}</td>
            <td>{{ r.cooling_time or "" }}</td>
            <td>{{ r.change_note or "" }}</td>
          </tr>
        {% else %}
          <tr>
            <td colspan="37" style="text-align:center; padding:24px;">該当データがありません。</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
